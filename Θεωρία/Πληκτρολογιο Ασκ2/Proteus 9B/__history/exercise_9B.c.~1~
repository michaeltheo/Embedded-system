//Πρόγραμμα
#include <main-proteus.h>
#include <keypad-proteus.h> // πρόγραμμα ανάγνωσης από πληκτρολόγιο 4Χ4
         //Προσοχή!!! Η πόρτα D χρησιμοποιείται για το 
         //πληκτρολόγιο. Να ελεγχθούν οι ορισμοί των συνδέσεων
         // στο αρχείο keypad.h. Ανοίξτε το με το notepad και 
         //διορθώστε τους ορισμούς των συνδέσεων αν δεν 
         //ανταποκρίνονται στο σχέδιο.
#include <flex_lcd-proteus.h> //πρόγραμμα εμφάνισης σε οθόνη LCD δύο γραμμών
         //Προσοχή!!! Η πόρτα Β χρησιμοποιείται για την οδήγηση της
         //οθόνης. Να ελεγχθούν οι ορισμοί των συνδέσεων
         // στο αρχείο flex_lcd.h. Ανοίξτε το με το notepad και 
         //διορθώστε τους ορισμούς των συνδέσεων αν δεν
         //ανταποκρίνονται στο σχέδιο.
#byte PORTB=0xf81  //θέση του καταχωρητή δεδομένων της πόρτας Β
#byte PORTD=0xf83  // θέση του καταχωρητή δεδομένων της πόρτας D

// Δήλωση ρουτινών, συναρτήσεων
void init(void);

//Κύριο πρόγραμμα
void main()
{
char k; // μεταβλητή char για αποθήκευση του ASCII κώδικα του πληκτρου
   // που πατήθηκε
init();  // αρχικοποίηση, η συνάρτηση αρχικοποίησης έχει γραφεί στο τέλος
lcd_init(); //αρχικοποίηση της οθόνης lcd.
kbd_init(); // αρχικοποίηση της συνάρτησης ανάγνωσης από το πληκτρολόγιο

while(TRUE) {   // εκτελείται συνεχώς ένας βρόχος
   k=kbd_getc(); //σε κάθε εκτέλεση του βρόχου διαβάζεται ο ASCII κώδικας
         // του πλήκτρου που πατήθηκε. Αν δεν πατήθηκε κανένα 
         // πλήκτρο επιστρέφεται στην μεταβλητή κ η τιμή 0
   if (k!=0)         { //αν πατήθηκε κάποιο πλήκτρο(k!=0) εκτελείται αυτό που είναι
         // μέσα στις αγκύλες
         lcd_gotoxy(4,1); // ετοιμασία της οθόνης για εγγραφή στην 
                  // 5η θέση της 1ης γραμμής
         lcd_putc(k);         // αποστέλλεται στην 5η θέση της 1ης γραμμής 
               // της οθόνης ο ASCII κώδικας του πλήκτρου
               // που πατήθηκε. Εμφανίζεται το σύμβολο που 
               //αντιστοιχεί στον ASCII κώδικα του πλήκτρου που
               //πατήθηκε
         } //κλείνει η αγκύλη του if

      } //κλείνει η αγκύλη του while(TRUE)

} // κλείνει η αγκύλη της main

// Κώδικας της συνάρτησης αρχικοποίησης
void init(void){
set_tris_b(0x00); // Η πόρτα B γίνεται έξοδος, χρησιμοποιείται για την οδήγηση
          // της οθόνης LCD
PORTB=0;
           }


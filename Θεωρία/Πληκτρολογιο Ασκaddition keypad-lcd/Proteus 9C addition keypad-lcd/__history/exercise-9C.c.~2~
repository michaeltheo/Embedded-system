#include <main.h>
#include <keypad.h>      // πρόγραμμα οδήγησης (driver) για ανάγνωση από πληκτρολόγιο 4Χ4
         //Προσοχή!!! Η πόρτα D χρησιμοποιείται για το 
         //πληκτρολόγιο. Να ελεγχθούν οι ορισμοί των συνδέσεων
         // στο αρχείο keypad.h. Ανοίξτε το αρχείο keypad.h με το notepad και 
         //διορθώστε τους ορισμούς των συνδέσεων σε περίπτωση που δεν 
         //ανταποκρίνονται στο σχέδιο.
#include <flex_lcd.h>      //πρόγραμμα οδήγησης (driver) για εμφάνιση σε οθόνη LCD δύο γραμμών
         //Προσοχή!!! Η πόρτα Β χρησιμοποιείται για την οδήγηση της
         //οθόνης. Να ελεγχθούν οι ορισμοί των συνδέσεων
         // στο αρχείο flex_lcd.h. Ανοίξτε το μ αρχείο flex_lcd.h με το notepad και 
         //διορθώστε τους ορισμούς των συνδέσεων σε περίπτωση που δεν
         //ανταποκρίνονται στο σχέδιο.
#byte PORTB=0xf81     //θέση του καταχωρητή δεδομένων της πόρτας Β στην μνήμη δεδομένων του
// μικρολεγκτή PIC 18F4550
#byte PORTD=0xf83      // θέση του καταχωρητή δεδομένων της πόρτας D

//Δήλωση συνάρτησης αρχικοποίησης
void init(void);

//Πρόγραμμα
#include <main.h>
#include <keypad.h>       // πρόγραμμα ανάγνωσης από πληκτρολόγιο 4Χ4
         //Προσοχή!!! Η πόρτα D χρησιμοποιείται για το 
         //πληκτρολόγιο. Να ελεγχθούν οι ορισμοί των συνδέσεων
         // στο αρχείο keypad.h. Ανοίξτε το με το notepad και 
         //διορθώστε τους ορισμούς των συνδέσεων αν δεν 
         //ανταποκρίνονται στο σχέδιο.
#include <flex_lcd.h>      //πρόγραμμα εμφάνισης σε οθόνη LCD δύο γραμμών
         //Προσοχή!!! Η πόρτα Β χρησιμοποιείται για την οδήγηση της
         //οθόνης. Να ελεγχθούν οι ορισμοί των συνδέσεων
         // στο αρχείο flex_lcd.h. Ανοίξτε το με το notepad και 
         //διορθώστε τους ορισμούς των συνδέσεων αν δεν
         //ανταποκρίνονται στο σχέδιο.
#byte PORTB=0xf81  //θέση του καταχωρητή δεδομένων της πόρτας Β
#byte PORTD=0xf83  // θέση του καταχωρητή δεδομένων της πόρτας D

// Δήλωση μεταβλητών
char state=1;
char N1=0;
char N2=0;

// Δήλωση ρουτινών, συναρτήσεων
void init(void);

//Κύριο πρόγραμμα
void main()
{
char k; // μεταβλητή char για αποθήκευση του ASCII κώδικα του πληκτρου
   // που πατήθηκε
init();  // αρχικοποίηση, η συνάρτηση αρχικοποίησης έχει γραφεί στο τέλος
lcd_init(); //αρχικοποίηση της οθόνης lcd.
kbd_init(); // αρχικοποίηση της συνάρτησης ανάγνωσης από το πληκτρολόγιο

while(TRUE)     {   // εκτελείται συνεχώς ένας βρόχος
      
      switch(state)   {
      case 1:
         k=kbd_getc();
         while(k!=0)
         {
         N1=k&0b00001111;
         printf(lcd_putc,"%1d+",N1);
         state=2;
         break;
         }
         break;
      case2 :
         k=kbd_getc();
         while(k!=0)
         {
         N2=k&0b00001111;
         printf(lcd_putc,"%1d=",N2);
         N2=N2+N1
         N1=0;
         N2=0
         state=1;
            delay_ms(2000);
            printf(lcd_putc, "\f");
            break;
}  //κλείνει το while(k!=0)
}//κλείνει το switch(state)
      } //κλείνει η αγκύλη του while(TRUE)
} // κλείνει η αγκύλη της main

// Κώδικας της συνάρτησης αρχικοποίησης
void init(void){
set_tris_d(0x00); // Η πόρτα B γίνεται έξοδος, χρησιμοποιείται για την οδήγηση
          // της οθόνης LCD
           }

